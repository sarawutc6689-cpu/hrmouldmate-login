<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz11yRb-zFzAZ--YcYaHydHfCow6xEZ2JUb_FnLc34TftadbUw1ZyTDAc98zeOigRqEew/exec";
  const LOGIN_URL = "Index_AMS.html"; 
  const TARGET_URL = "https://sites.google.com/view/amsmouldmate"; 

  function checkAuth() {
    const token = localStorage.getItem("authToken");
    const expireTime = localStorage.getItem("expireTime");

    console.log("ðŸ”‘ token =", token);
    console.log("â³ expireTime =", expireTime);

    if (!token || !expireTime || new Date().getTime() > parseInt(expireTime, 10)) {
      console.warn("âš  Token à¹„à¸¡à¹ˆà¹€à¸ˆà¸­à¸«à¸£à¸·à¸­à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸");
      redirectToLogin();
      return;
    }

    fetch(SCRIPT_URL + "?action=verify&token=" + token)
      .then(res => res.json())
      .then(data => {
        console.log("âœ… verify response =", data);
        if (data.valid) {
          console.log("ðŸŽ¯ redirect à¹„à¸› Target URL:", TARGET_URL);
          window.location.replace(TARGET_URL);
        } else {
          console.warn("âŒ token à¹„à¸¡à¹ˆ valid");
          redirectToLogin();
        }
      })
      .catch(err => {
        console.error("ðŸš¨ fetch error =", err);
        redirectToLogin();
      });
  }

  function redirectToLogin() {
    localStorage.clear();
    window.location.replace(LOGIN_URL);
  }
</script>
