<body>
  <div class="container">
    <h2>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...</h2>
    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</p>
    <div id="msg"></div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz11yRb-zFzAZ--YcYaHydHfCow6xEZ2JUb_FnLc34TftadbUw1ZyTDAc98zeOigRqEew/exec";
    const LOGIN_URL = "Index_AMS.html"; 
    const TARGET_URL = "https://sites.google.com/view/amsmouldmate"; 

    function checkAuth() {
      console.log("üöÄ checkAuth ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô");

      const token = localStorage.getItem("authToken");
      const expireTime = localStorage.getItem("expireTime");

      console.log("üîë token =", token);
      console.log("‚è≥ expireTime =", expireTime);

      if (!token || !expireTime || new Date().getTime() > parseInt(expireTime, 10)) {
        console.warn("‚ö† Token ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏");
        redirectToLogin();
        return;
      }

      fetch(SCRIPT_URL + "?action=verify&token=" + token)
        .then(res => res.json())
        .then(data => {
          console.log("‚úÖ verify response =", data);
          if (data.valid) {
            console.log("üéØ redirect ‡πÑ‡∏õ Target URL:", TARGET_URL);
            window.location.replace(TARGET_URL);
          } else {
            console.warn("‚ùå token ‡πÑ‡∏°‡πà valid");
            redirectToLogin();
          }
        })
        .catch(err => {
          console.error("üö® fetch error =", err);
          redirectToLogin();
        });
    }

    function redirectToLogin() {
      localStorage.clear();
      window.location.replace(LOGIN_URL);
    }

    // ‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ script ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    document.addEventListener("DOMContentLoaded", checkAuth);
  </script>
</body>
