<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz11yRb-zFzAZ--YcYaHydHfCow6xEZ2JUb_FnLc34TftadbUw1ZyTDAc98zeOigRqEew/exec";
  const LOGIN_URL = "Index_AMS.html"; 
  const TARGET_URL = "https://sites.google.com/view/amsmouldmate"; 

  function checkAuth() {
    const token = localStorage.getItem("authToken");
    const expireTime = localStorage.getItem("expireTime");

    console.log("🔑 token =", token);
    console.log("⏳ expireTime =", expireTime);

    if (!token || !expireTime || new Date().getTime() > parseInt(expireTime, 10)) {
      console.warn("⚠ Token ไม่เจอหรือหมดอายุ");
      redirectToLogin();
      return;
    }

    fetch(SCRIPT_URL + "?action=verify&token=" + token)
      .then(res => res.json())
      .then(data => {
        console.log("✅ verify response =", data);
        if (data.valid) {
          console.log("🎯 redirect ไป Target URL:", TARGET_URL);
          window.location.replace(TARGET_URL);
        } else {
          console.warn("❌ token ไม่ valid");
          redirectToLogin();
        }
      })
      .catch(err => {
        console.error("🚨 fetch error =", err);
        redirectToLogin();
      });
  }

  function redirectToLogin() {
    localStorage.clear();
    window.location.replace(LOGIN_URL);
  }
</script>
